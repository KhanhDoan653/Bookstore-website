<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ocean Horizon | Shop</title>
      <link rel="stylesheet" href="css/index.css">
      <link rel="stylesheet" href="css/shop.css">
    <link rel="icon" type="image/png" href="img/Ocean_Horizon_Website_Icon.png">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
</head>
<body>
         <div class="bubbles">
    <span></span>
    <span></span>
    <span></span>
    <span></span>
    <span></span>
    <span></span>
    <span></span>
    <span></span>
    <span></span>
    <span></span>
  </div>
     <header>
       <a href="index.html"><img src="img/Ocean_Horizon_Website_Icon.png" alt="Ocean Horizon Logo" class="logohd"></a> 
       <a href="index.html"> Trang Ch·ªß</a>
              <!-- Dropdown -->
  <div class="dropdown">
    <a href="about.html" class="dropbtn">Gi·ªõi Thi·ªáu</a>
    <div class="dropdown-content">
      <a href="tuyendung.html">Tuy·ªÉn D·ª•ng</a>
    </div>
  </div>
        
<!-- √î t√¨m ki·∫øm -->
<form action="#" method="get" class="search-box" onsubmit="return false;">
  <input type="text" id="searchInput" placeholder="T√¨m ki·∫øm s√°ch..." required>
  <button type="button" onclick="searchProducts()">üîç</button>
</form>
  <a href="contact.html">T∆∞ V·∫•n</a>
     <a href="shop.html" class="cart-link">
  Gi·ªè h√†ng <span id="cart-count">0</span>
</a>

       <a href="login.html"> ƒêƒÉng Nh·∫≠p</a>

    </header>


  <h1>Gi·ªè H√†ng</h1>
  <table class="cart-table" id="cartTable">
    <thead>
      <tr>
       
        <th>S·∫£n ph·∫©m</th>
        <th>Gi√°</th>
        <th>X√≥a</th>
      </tr>
    </thead>
    <tbody id="cartBody">
      <!-- S·∫£n ph·∫©m s·∫Ω ƒë∆∞·ª£c render ·ªü ƒë√¢y -->
    </tbody>
  </table>

  <div class="total" id="cartTotal">T·ªïng: 0ƒë</div>

  <div class="empty-cart" id="emptyCartMsg" style="display:none;">
    Gi·ªè h√†ng tr·ªëng!
  </div>


<!-- Th√™m n√∫t Thanh To√°n -->
<div class="checkout-container">
  <button id="checkoutBtn">Thanh To√°n</button>
</div>

<!-- Popup thanh to√°n -->
<div id="checkoutModal" class="modal">
  <div class="modal-content">
    <span class="close">&times;</span>
    <h2>Thanh To√°n</h2>
    <p id="modalTotal">T·ªïng: 0ƒë</p>
    <button id="downloadBill">T·∫£i H√≥a ƒê∆°n</button>
    <div class="qr-container">
      <p>Qu√©t m√£ QR ƒë·ªÉ chuy·ªÉn kho·∫£n:</p>
      <img src="img/BankQR.jpg" alt="QR Bank" class="qr-code">
    </div>
  </div>


  
 <script>
   function renderCart() {
      const cartItems = JSON.parse(localStorage.getItem('cart')) || [];
      const cartBody = document.getElementById('cartBody');
      const cartTotal = document.getElementById('cartTotal');
      const emptyCartMsg = document.getElementById('emptyCartMsg');

      cartBody.innerHTML = '';
      if(cartItems.length === 0) {
        document.querySelector('.cart-table').style.display = 'none';
        cartTotal.style.display = 'none';
        emptyCartMsg.style.display = 'block';
        return;
      } else {
        document.querySelector('.cart-table').style.display = 'table';
        cartTotal.style.display = 'block';
        emptyCartMsg.style.display = 'none';
      }

      let total = 0;

      cartItems.forEach((item, index) => {
        // Chuy·ªÉn gi√° sang s·ªë
        let price = parseInt(item.price.replace(/\D/g,''));
        total += price;

        const tr = document.createElement('tr');

        tr.innerHTML = `
          <td>${item.name}</td>
          <td>${item.price}</td>
          <td><button class="remove-btn" data-index="${index}">X√≥a</button></td>
        `;

        cartBody.appendChild(tr);
      });

      cartTotal.innerText = `T·ªïng: ${total.toLocaleString('vi-VN')}ƒë`;

      // X·ª≠ l√Ω x√≥a
      const removeBtns = document.querySelectorAll('.remove-btn');
      removeBtns.forEach(btn => {
        btn.addEventListener('click', function() {
          const index = this.dataset.index;
          cartItems.splice(index, 1);
          localStorage.setItem('cart', JSON.stringify(cartItems));
          renderCart();
        });
      });
    }

    window.addEventListener('load', renderCart);

const checkoutBtn = document.getElementById('checkoutBtn');
const modal = document.getElementById('checkoutModal');
const closeBtn = modal.querySelector('.close');
const modalTotal = document.getElementById('modalTotal');
const downloadBill = document.getElementById('downloadBill');

checkoutBtn.addEventListener('click', () => {
  const cartItems = JSON.parse(localStorage.getItem('cart')) || [];
  let total = 0;
  cartItems.forEach(item => {
    total += parseInt(item.price.replace(/\D/g,''));
  });
  modalTotal.innerText = `T·ªïng: ${total.toLocaleString('vi-VN')}ƒë`;
  modal.style.display = 'flex';
});

closeBtn.addEventListener('click', () => {
  modal.style.display = 'none';
});

window.addEventListener('click', (e) => {
  if(e.target === modal) modal.style.display = 'none';
});

// T·∫£i h√≥a ƒë∆°n d∆∞·ªõi d·∫°ng file text
downloadBill.addEventListener('click', () => {
  const cartItems = JSON.parse(localStorage.getItem('cart')) || [];
  let content = 'H√ìA ƒê∆†N OCEAN HORIZON\n\n';
  cartItems.forEach(item => {
    content += `${item.name} - ${item.price}\n`;
  });
  let total = cartItems.reduce((sum, item) => sum + parseInt(item.price.replace(/\D/g,'')), 0);
  content += `\nT·ªïng: ${total.toLocaleString('vi-VN')}ƒë\n`;
  
  const blob = new Blob([content], {type: 'text/plain'});
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a');
  a.href = url;
  a.download = 'hoa_don.txt';
  a.click();
  URL.revokeObjectURL(url);
});

  </script>
</body>
</html>