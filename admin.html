<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Admin - Ocean Horizon</title>
<link rel="icon" type="image/png" href="img/Ocean_Horizon_Website_Icon.png">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css">
<style>
/* ===========================
üî• OCEAN HORIZON ADMIN STYLE üî•
Theme: Cyber Deep Ocean
=========================== */

@import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@500;700&display=swap');

body {
  font-family: 'Orbitron', Arial, sans-serif;
  margin: 0;
  padding: 0;
  background: radial-gradient(circle at 20% 20%, #001d3d, #000814 80%);
  color: #E0F7FA;
  overflow-x: hidden;
}

/* --- HEADER --- */
header {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  background: linear-gradient(135deg, #001F3F, #003B6F, #0077B6);
  color: #E0F7FA;
  box-shadow: 0 0 25px rgba(0,180,216,0.6);
  border-bottom: 2px solid rgba(0,180,216,0.4);
  z-index: 1000;
}

header .container {
  max-width: 1200px; /* t√πy ch·ªânh, 1000‚Äì1300 l√† h·ª£p l√Ω */
  margin: 0 auto;    /* cƒÉn gi·ªØa */
  padding: 15px 50px;
  display: flex;
  align-items: center;
  justify-content: space-between;
}



@keyframes glowHeader {
  0% { box-shadow: 0 0 15px #0077B6; }
  100% { box-shadow: 0 0 30px #00B4D8; }
}

header h1 {
  margin: 0;
  font-size: 15px;
  font-weight: 700;
  letter-spacing: 2px;
  text-transform: uppercase;
  text-shadow: 0 0 10px #00B4D8;
}

header a {
  color: #CAF0F8;
  font-weight: bold;
  text-decoration: none;
  padding: 8px 18px;
  border: 1px solid #00B4D8;
  border-radius: 6px;
  transition: 0.3s;
  box-shadow: 0 0 10px rgba(0,180,216,0.3);
}
header a:hover {
  background: #00B4D8;
  color: #001F3F;
  box-shadow: 0 0 20px #00B4D8;
}

/* --- MAIN CONTAINER --- */
.container {
  max-width: 1100px;
  margin: 120px auto 40px auto;
  padding: 35px;
  background: rgba(17, 45, 78, 0.85);
  border-radius: 16px;
  box-shadow: 0 0 40px rgba(0,180,216,0.4);
  backdrop-filter: blur(10px);
  border: 1px solid rgba(0,180,216,0.3);
  animation: fadeIn 1s ease-in-out;
}

@keyframes fadeIn {
  from { opacity: 0; transform: translateY(20px); }
  to { opacity: 1; transform: translateY(0); }
}

/* --- SECTION TITLES --- */
h2 {
  text-align: center;
  font-size: 22px;
  color: #90E0EF;
  text-shadow: 0 0 10px #00B4D8;
  border-bottom: 1px solid rgba(0,180,216,0.3);
  padding-bottom: 8px;
  margin-bottom: 25px;
}

/* --- FORM ELEMENTS --- */
input, select {
  padding: 12px;
  margin: 8px;
  width: 250px;
  border: 1px solid rgba(0,180,216,0.5);
  border-radius: 8px;
  background: rgba(10, 52, 96, 0.9);
  color: #E0F7FA;
  transition: 0.3s;
}
input:focus, select:focus {
  outline: none;
  border-color: #00B4D8;
  box-shadow: 0 0 15px #00B4D8;
  background: rgba(14, 68, 128, 1);
}

/* --- BUTTONS --- */
button {
  padding: 12px 20px;
  margin: 8px 5px;
  border: 1px solid #00B4D8;
  border-radius: 8px;
  background: linear-gradient(135deg, #0077B6, #00B4D8);
  color: white;
  cursor: pointer;
  font-weight: 700;
  letter-spacing: 1px;
  text-transform: uppercase;
  transition: all 0.3s ease;
  box-shadow: 0 0 15px rgba(0,180,216,0.4);
}
button:hover {
  background: linear-gradient(135deg, #00B4D8, #90E0EF);
  color: #001F3F;
  transform: translateY(-3px);
  box-shadow: 0 0 25px #00B4D8;
}

/* --- CATEGORY LIST --- */
ul {
  list-style: none;
  padding: 0;
}
li {
  margin: 8px 0;
  padding: 10px 14px;
  background: rgba(27, 58, 87, 0.9);
  border-radius: 8px;
  color: #E0F7FA;
  display: flex;
  justify-content: space-between;
  align-items: center;
  box-shadow: 0 0 10px rgba(0,180,216,0.3);
  transition: 0.3s;
}
li:hover {
  background: rgba(30, 70, 110, 1);
  box-shadow: 0 0 20px rgba(0,180,216,0.5);
}

/* --- PRODUCT ITEM --- */
.admin-product {
  display: flex;
  align-items: center;
  background: rgba(18, 40, 70, 0.9);
  margin-bottom: 15px;
  padding: 14px;
  border-radius: 10px;
  border: 1px solid rgba(0,180,216,0.3);
  box-shadow: 0 0 20px rgba(0,180,216,0.3);
  transition: 0.3s;
}
.admin-product:hover {
  transform: scale(1.02);
  box-shadow: 0 0 25px rgba(0,180,216,0.5);
}
.admin-product img {
  width: 70px;
  height: 70px;
  object-fit: cover;
  margin-right: 15px;
  border-radius: 8px;
  border: 2px solid #00B4D8;
  box-shadow: 0 0 10px #00B4D8;
}
.product-name {
  color: #E0F7FA;
  font-weight: bold;
  flex: 1;
  text-shadow: 0 0 6px #00B4D8;
}

/* --- MODAL --- */
.modal {
  display: none;
  position: fixed;
  top:0; left:0;
  width:100%; height:100%;
  background: rgba(0,0,0,0.8);
  justify-content: center;
  align-items: center;
  backdrop-filter: blur(6px);
  z-index: 2000;
}
.modal-content {
  background: rgba(17, 45, 78, 0.95);
  padding: 30px;
  border-radius: 12px;
  width: 420px;
  position: relative;
  border: 1px solid #00B4D8;
  box-shadow: 0 0 40px rgba(0,180,216,0.6);
  animation: modalPop 0.4s ease;
}
@keyframes modalPop {
  from { transform: scale(0.9); opacity: 0; }
  to { transform: scale(1); opacity: 1; }
}
.modal-content h3 {
  text-align: center;
  font-weight: bold;
  font-size: 22px;
  color: #00B4D8;
  text-shadow: 0 0 15px #00B4D8;
}
.close-btn {
  position: absolute;
  top: 10px;
  right: 15px;
  cursor: pointer;
  font-size: 24px;
  color: #90E0EF;
  transition: 0.3s;
}
.close-btn:hover {
  color: #00B4D8;
  transform: rotate(90deg);
}

/* --- SCROLLBAR CUSTOM --- */
::-webkit-scrollbar {
  width: 10px;
}
::-webkit-scrollbar-track {
  background: #001d3d;
}
::-webkit-scrollbar-thumb {
  background: linear-gradient(#00B4D8, #0077B6);
  border-radius: 5px;
}
::-webkit-scrollbar-thumb:hover {
  background: linear-gradient(#00E0FF, #0096C7);
}
.user-menu {
  position: absolute;
  right: 150px;        /* tƒÉng t·ª´ 30px ‚Üí 80px cho l·ªách tr√°i h∆°n */
  top: 50%;
  transform: translateY(-50%);
  display: flex;
  align-items: center;
  gap: 10px;
  cursor: pointer;
  color: #fff;
  font-weight: bold;
  z-index: 1100;
}


.username {
  color: #90E0EF;
  font-weight: bold;
  cursor: pointer;
  padding: 8px 15px;
  border: 1px solid rgba(0,180,216,0.5);
  border-radius: 6px;
  background: linear-gradient(135deg, #002b5c, #004b8d);
  box-shadow: 0 0 10px rgba(0,180,216,0.5);
  transition: all 0.3s;

}

.username:hover {
  background: #00B4D8;
  color: white;
  box-shadow: 0 0 20px #00B4D8;
}

.dropdown-user {
  display: none;
  position: absolute;
  right: 0;
  top: 110%;
  background: #002b5c;
  border-radius: 8px;
  box-shadow: 0 4px 15px rgba(0,0,0,0.5);
  overflow: hidden;
  z-index: 999;
  min-width: 180px; /* tƒÉng t·ª´ 150 ‚Üí 180 ƒë·ªÉ kh√¥ng b·ªã c·∫Øt ch·ªØ */
}


.dropdown-user a {
  display: block;
  padding: 10px 15px;
  color: #E0F7FA;
  text-decoration: none;
  transition: background 0.3s;
}

.dropdown-user a:hover {
  background: #00B4D8;
  color: white;
}

.dropdown-user.show {
  display: block;
}

/* Popup h·ªì s∆° */
.profile-popup {
  position: fixed;
  top: 0; left: 0;
  width: 100%; height: 100%;
  background: rgba(0, 0, 0, 0.7);
  display: none;
  justify-content: center;
  align-items: center;
  z-index: 9999;
}

.profile-popup .popup-content {
  background: radial-gradient(circle at top, #002855, #001d3d);
  border: 2px solid #00b4d8;
  box-shadow: 0 0 30px #00b4d8;
  padding: 25px 35px;
  border-radius: 15px;
  text-align: center;
  color: #E0F7FA;
  animation: fadeIn 0.3s ease;
}

.profile-popup img {
  width: 120px;
  height: 120px;
  border-radius: 50%;
  border: 3px solid #00B4D8;
  margin-bottom: 15px;
}

@keyframes fadeIn {
  from { opacity: 0; transform: scale(0.8); }
  to { opacity: 1; transform: scale(1); }
}

/* --- N√∫t L√™n ƒê·∫ßu Trang --- */
#scrollTopBtn {
  position: fixed;
  bottom: 30px;
  right: 30px;
  background-color: #0077b6; /* xanh d∆∞∆°ng bi·ªÉn */
  color: white;
  border: none;
  border-radius: 50%;
  width: 45px;
  height: 45px;
  font-size: 20px;
  cursor: pointer;
  box-shadow: 0 4px 8px rgba(0,0,0,0.3);
  transition: all 0.3s ease;
  display: none; /* M·∫∑c ƒë·ªãnh ·∫©n */
  z-index: 999;
}

#scrollTopBtn:hover {
  background-color: #00b4d8;
  transform: scale(1.1);
}

/* =======================
üéÜ EVENT POPUP STYLE üéÜ
======================= */

#eventPopup .modal-content {
  background: rgba(17, 45, 78, 0.95); /* m√†u n·ªÅn ƒë·ªìng b·ªô v·ªõi container */
  border: 2px solid #00B4D8;
  box-shadow: 0 0 40px rgba(0,180,216,0.6);
  padding: 30px;
  border-radius: 16px;
  width: 420px;
  max-width: 90%;
  position: relative;
  animation: modalPop 0.4s ease;
  display: flex;
  flex-direction: column;
  gap: 12px;
  color: #E0F7FA;
  font-family: 'Orbitron', sans-serif;
}

#eventPopup h3 {
  text-align: center;
  font-size: 22px;
  font-weight: bold;
  color: #00B4D8;
  text-shadow: 0 0 15px #00B4D8;
  margin-bottom: 15px;
}

/* Close button */
#eventPopup .close-btn {
  position: absolute;
  top: 12px;
  right: 18px;
  font-size: 26px;
  color: #90E0EF;
  cursor: pointer;
  transition: 0.3s;
}

#eventPopup .close-btn:hover {
  color: #00B4D8;
  transform: rotate(90deg);
}

/* Inputs v√† labels */
#eventPopup input[type="text"],
#eventPopup input[type="date"] {
  width: 90%;
  padding: 10px 12px;
  border-radius: 8px;
  border: 1px solid rgba(0,180,216,0.5);
  background: rgba(10,52,96,0.9);
  color: #E0F7FA;
  transition: 0.3s;
}

#eventPopup input::placeholder {
  color: #b0e0f0;
}

#eventPopup input:focus {
  outline: none;
  border-color: #00B4D8;
  box-shadow: 0 0 15px #00B4D8;
  background: rgba(14,68,128,1);
}

#eventPopup label {
  font-weight: 500;
  color: #90E0EF;
  margin-top: 8px;
}

/* Book select list */
#eventPopup #bookSelectList {
  max-height: 150px;
  overflow-y: auto;
  background: rgba(10,52,96,0.6);
  padding: 10px;
  border-radius: 8px;
  border: 1px solid rgba(0,180,216,0.3);
  display: flex;
  flex-direction: column;
  gap: 6px;
}

/* Scrollbar cho danh s√°ch s√°ch */
#eventPopup #bookSelectList::-webkit-scrollbar {
  width: 10px;
}
#eventPopup #bookSelectList::-webkit-scrollbar-track {
  background: #001d3d;
}
#eventPopup #bookSelectList::-webkit-scrollbar-thumb {
  background: linear-gradient(#00B4D8, #0077B6);
  border-radius: 5px;
}
#eventPopup #bookSelectList::-webkit-scrollbar-thumb:hover {
  background: linear-gradient(#00E0FF, #0096C7);
}

/* Checkbox + img + label - S·ª¨A ƒê·ªÇ TH·∫≤NG H√ÄNG */
#eventPopup #bookSelectList label {
  display: flex;
  align-items: center;
  width: 100%; /* ƒê·∫£m b·∫£o label chi·∫øm h·∫øt chi·ªÅu r·ªông */
  padding: 8px 12px; /* TƒÉng padding ƒë·ªÉ ƒë·ªÅu h∆°n */
  border-radius: 6px;
  transition: background 0.2s;
  box-sizing: border-box; /* ƒê·ªÉ padding kh√¥ng l√†m l·ªách k√≠ch th∆∞·ªõc */
}

#eventPopup #bookSelectList label:hover {
  background: rgba(0,180,216,0.2);
}

/* Checkbox: C·ªë ƒë·ªãnh v·ªã tr√≠ v√† k√≠ch th∆∞·ªõc */
#eventPopup #bookSelectList input[type="checkbox"] {
  flex-shrink: 0; /* Kh√¥ng co l·∫°i */
  margin-right: 10px; /* Kho·∫£ng c√°ch c·ªë ƒë·ªãnh */
  width: 16px; /* K√≠ch th∆∞·ªõc checkbox c·ªë ƒë·ªãnh */
  height: 16px;
  accent-color: #00B4D8; /* M√†u checkbox khi checked */
}

/* Img: C·ªë ƒë·ªãnh v·ªã tr√≠ v√† k√≠ch th∆∞·ªõc */
#eventPopup #bookSelectList img {
  flex-shrink: 0; /* Kh√¥ng co l·∫°i */
  width: 40px;
  height: 40px;
  border-radius: 5px;
  margin-right: 10px; /* Kho·∫£ng c√°ch c·ªë ƒë·ªãnh */
  object-fit: cover; /* ƒê·ªÉ ·∫£nh kh√¥ng b·ªã m√©o */
}

/* Span (t√™n s√°ch): Linh ho·∫°t nh∆∞ng gi·ªõi h·∫°n ƒë·ªÉ tr√°nh l·ªách h√†ng */
#eventPopup #bookSelectList span {
  flex: 1; /* Chi·∫øm h·∫øt kh√¥ng gian c√≤n l·∫°i */
  white-space: nowrap; /* Kh√¥ng xu·ªëng d√≤ng */
  overflow: hidden; /* ·∫®n ph·∫ßn th·ª´a */
  text-overflow: ellipsis; /* Th√™m d·∫•u ... n·∫øu qu√° d√†i */
  font-size: 14px; /* K√≠ch th∆∞·ªõc ch·ªØ nh·ªè h∆°n ƒë·ªÉ v·ª´a */
}

/* N√∫t l∆∞u s·ª± ki·ªán */
#eventPopup button#saveEventBtn {
  padding: 12px;
  border-radius: 8px;
  border: 1px solid #00B4D8;
  background: linear-gradient(135deg, #0077B6, #00B4D8);
  color: #fff;
  font-weight: bold;
  text-transform: uppercase;
  cursor: pointer;
  transition: all 0.3s ease;
  box-shadow: 0 0 15px rgba(0,180,216,0.4);
  margin-top: 10px;
}

#eventPopup button#saveEventBtn:hover {
  background: linear-gradient(135deg, #00B4D8, #90E0EF);
  color: #001F3F;
  transform: translateY(-2px);
  box-shadow: 0 0 25px #00B4D8;
}

</style>
</head>
<body>
<script src="js/admin.js" defer></script>

<header>
  <div class="container">
    <h1>QU·∫¢N L√ù C·ª¨A H√ÄNG</h1>
    <a href="login.html" id="loginLink">ƒêƒÉng nh·∫≠p</a>
  </div>
</header>


<div class="container">

  <!-- Qu·∫£n l√Ω ch·ªß ƒë·ªÅ -->
  <section id="categoryManager">
    <h2>Qu·∫£n L√Ω Ch·ªß ƒê·ªÅ</h2>
    <input type="text" id="newCategoryName" placeholder="T√™n ch·ªß ƒë·ªÅ m·ªõi">
    <button id="addCategoryBtn">Th√™m Ch·ªß ƒê·ªÅ</button>
    <ul id="categoryList"></ul>
  </section>

<!-- Qu·∫£n l√Ω s·ª± ki·ªán -->
<section id="eventManager">
  <h2>Qu·∫£n L√Ω S·ª± Ki·ªán</h2>
  <button id="addEventBtn">Th√™m S·ª± Ki·ªán</button>
  <div id="eventList"></div>
</section>

  <!-- Qu·∫£n l√Ω s·∫£n ph·∫©m -->
  <section id="productManager">
    <h2>Qu·∫£n L√Ω S·∫£n Ph·∫©m</h2>
    <button id="addProductBtn">Th√™m S·∫£n Ph·∫©m</button>
    <div id="adminProductList"></div>
  </section>

</div>
  <!-- N√∫t l√™n ƒë·∫ßu trang -->
<button id="scrollTopBtn" title="L√™n ƒë·∫ßu trang">
  <i class="fas fa-arrow-up"></i>
</button>

<!-- Popup Th√™m/S·ª≠a s·∫£n ph·∫©m -->
<div id="productPopup" class="modal">
  <div class="modal-content">
    <span class="close-btn">&times;</span>
    <h3 id="popupTitle">Th√™m S·∫£n Ph·∫©m</h3>
    <select id="productCategory"></select>
    <input type="text" id="productName" placeholder="T√™n s·∫£n ph·∫©m">
    <input type="text" id="productPrice" placeholder="Gi√°">
    <input type="text" id="productOldPrice" placeholder="Gi√° c≈© (n·∫øu c√≥)">
    <input type="text" id="productPublisher" placeholder="Nh√† xu·∫•t b·∫£n">
    <input type="text" id="productYear" placeholder="NƒÉm xu·∫•t b·∫£n">
    <input type="file" id="productImage" accept="image/*">
    <button id="saveProductBtn">L∆∞u</button>
  </div>



</div>

  <!-- Popup Th√™m/S·ª≠a S·ª± Ki·ªán -->
<div id="eventPopup" class="modal">
  <div class="modal-content">
    <span class="close-btn" id="closeEventPopup">&times;</span>
    <h3 id="eventPopupTitle">Th√™m S·ª± Ki·ªán</h3>
    <input type="text" id="eventTitle" placeholder="T√™n s·ª± ki·ªán">
    <label>B·∫Øt ƒë·∫ßu:</label>
    <input type="date" id="eventStartDate">
    <label>K·∫øt th√∫c:</label>
    <input type="date" id="eventEndDate">
    <label>Ch·ªçn s√°ch tr∆∞ng b√†y:</label>
    <div id="bookSelectList" style="max-height:150px; overflow:auto; background:rgba(10,52,96,0.5); padding:10px; border-radius:8px;"></div>
    <button id="saveEventBtn">L∆∞u S·ª± Ki·ªán</button>
  </div>
</div>
<script>
let sections = JSON.parse(localStorage.getItem("sections")) || {};
let products = JSON.parse(localStorage.getItem("products")) || [];
let editIndex = null;

// --- Ch·ªß ƒë·ªÅ ---
function renderCategoryList() {
  const ul = document.getElementById("categoryList");
  ul.innerHTML = '';
  Object.keys(sections).forEach(cat => {
    const li = document.createElement("li");
    li.innerHTML = `
      ${cat} 
      <button onclick="deleteCategory('${cat}')">X√≥a</button>
    `;
    ul.appendChild(li);
  });
}

document.getElementById("addCategoryBtn").addEventListener("click", () => {
  const name = document.getElementById("newCategoryName").value.trim();
  if(!name) return alert("Nh·∫≠p t√™n ch·ªß ƒë·ªÅ!");
  if(!sections[name]) sections[name] = [];
  localStorage.setItem("sections", JSON.stringify(sections));
  document.getElementById("newCategoryName").value = '';
  renderCategoryList();
  renderCategoryOptions();
});

function deleteCategory(name) {
  if(confirm(`X√≥a ch·ªß ƒë·ªÅ "${name}" v√† t·∫•t c·∫£ s·∫£n ph·∫©m trong ƒë√≥?`)) {
    delete sections[name];
    localStorage.setItem("sections", JSON.stringify(sections));
    renderCategoryList();
    renderAdminProducts();
    renderCategoryOptions();
  }
}

// --- S·∫£n ph·∫©m ---
const popup = document.getElementById("productPopup");
const addBtn = document.getElementById("addProductBtn");
const closeBtn = popup.querySelector(".close-btn");
const saveBtn = document.getElementById("saveProductBtn");
const adminList = document.getElementById("adminProductList");

addBtn.addEventListener("click", () => {
  editIndex = null;
  popup.style.display = "flex";
  popup.querySelector("#popupTitle").innerText = "Th√™m S·∫£n Ph·∫©m";
  popup.querySelectorAll("input").forEach(input => input.value = '');
  renderCategoryOptions();
});

closeBtn.addEventListener("click", () => popup.style.display = "none");

function renderCategoryOptions() {
  const select = document.getElementById("productCategory");
  select.innerHTML = '';
  select.innerHTML = '<option value="">Ch·ªçn ch·ªß ƒë·ªÅ</option>';
  Object.keys(sections).forEach(cat => {
    const opt = document.createElement("option");
    opt.value = cat; opt.textContent = cat;
    select.appendChild(opt);
  });
}

saveBtn.addEventListener("click", () => {
  const category = document.getElementById("productCategory").value;
  const name = document.getElementById("productName").value.trim();
  const price = document.getElementById("productPrice").value.trim();
  const oldPrice = document.getElementById("productOldPrice").value.trim();
  const publisher = document.getElementById("productPublisher").value.trim();
  const year = document.getElementById("productYear").value.trim();
  const fileInput = document.getElementById("productImage");

  if(!category || !name || !price) return alert("ƒêi·ªÅn ƒë·∫ßy ƒë·ªß th√¥ng tin!");

  // l·∫•y ƒë∆∞·ªùng d·∫´n ·∫£nh (n·∫øu c√≥ upload)
  let imgPath = editIndex!==null ? products[editIndex].image : "";
  if (fileInput.files[0]) {
    imgPath = `img/${fileInput.files[0].name}`;
  }

  saveProduct(imgPath);

  function saveProduct(imgSrc) {
    const newProduct = {
      id: editIndex!==null ? products[editIndex].id : Date.now().toString(),
      name, price, oldPrice, publisher, year,
      image: imgSrc, // ch·ªâ l∆∞u ƒë∆∞·ªùng d·∫´n
      stock: true,
      category
    };

    if(editIndex!==null) {
      const oldCat = products[editIndex].category;
      sections[oldCat] = sections[oldCat].filter(p => p.id!==newProduct.id);
      products[editIndex] = newProduct;
    } else products.push(newProduct);

    if(!sections[category]) sections[category] = [];
    const idx = sections[category].findIndex(p=>p.id===newProduct.id);
    if(idx>=0) sections[category][idx] = newProduct;
    else sections[category].push(newProduct);

    localStorage.setItem("products", JSON.stringify(products));
    localStorage.setItem("sections", JSON.stringify(sections));
    popup.style.display = "none";
    renderAdminProducts();
    renderCategoryList();
  }
});

function renderAdminProducts() {
  adminList.innerHTML = '';
  products.forEach(p => {
    const div = document.createElement("div");
    div.className = "admin-product";
   div.innerHTML = `
  <img src="${p.image}" alt="${p.name}">
  <span class="product-name">${p.name} (${p.category}) - ${p.price}ƒë</span>
  <button onclick="editProduct('${p.category}','${p.id}')">S·ª≠a</button>
  <button onclick="deleteProductById('${p.id}')">X√≥a</button>
`;
    adminList.appendChild(div);
  });
}

// --- X√≥a s·∫£n ph·∫©m ---
function deleteProductById(id){
  if(confirm("B·∫°n c√≥ ch·∫Øc mu·ªën x√≥a s·∫£n ph·∫©m n√†y?")){
    const prodIndex = products.findIndex(p => p.id===id);
    if(prodIndex >=0){
      const cat = products[prodIndex].category;
      products.splice(prodIndex,1);
      // Ki·ªÉm tra sections[cat] tr∆∞·ªõc khi filter
      if(sections[cat]) {
        sections[cat] = sections[cat].filter(p=>p.id!==id);
      }
      localStorage.setItem("products", JSON.stringify(products));
      localStorage.setItem("sections", JSON.stringify(sections));
      renderAdminProducts();
      renderCategoryList();
    }
  }
}


function editProduct(cat, id) {
  const idx = products.findIndex(p => p.id === id);
  if (idx < 0) return;
  editIndex = idx;
  const p = products[idx];
  
  popup.style.display = "flex";
  popup.querySelector("#popupTitle").innerText = "S·ª≠a S·∫£n Ph·∫©m";

  // 1. Render t·∫•t c·∫£ ch·ªß ƒë·ªÅ tr∆∞·ªõc
  renderCategoryOptions();

  // 2. Ch·ªçn ch·ªß ƒë·ªÅ hi·ªán t·∫°i
  document.getElementById("productCategory").value = cat;

  // 3. ƒêi·ªÅn th√¥ng tin s·∫£n ph·∫©m
  document.getElementById("productName").value = p.name;
  document.getElementById("productPrice").value = p.price;
  document.getElementById("productOldPrice").value = p.oldPrice;
  document.getElementById("productPublisher").value = p.publisher;
  document.getElementById("productYear").value = p.year;
  document.getElementById("productImage").value = '';
}


function toggleStock(cat,i){
  sections[cat][i].stock = !sections[cat][i].stock;
  localStorage.setItem("sections", JSON.stringify(sections));
  renderAdminProducts();
}


let events = JSON.parse(localStorage.getItem("events")) || [];
let eventEditIndex = null;

// === M·ªü popup th√™m s·ª± ki·ªán ===
const eventPopup = document.getElementById("eventPopup");
const openEventPopupBtn = document.getElementById("addEventBtn");
const closeEventPopupBtn = document.getElementById("closeEventPopup");
const saveEventBtn = document.getElementById("saveEventBtn");

openEventPopupBtn.addEventListener("click", () => {
  eventEditIndex = null;
  document.getElementById("eventPopupTitle").innerText = "Th√™m S·ª± Ki·ªán";
  document.getElementById("eventTitle").value = "";
  document.getElementById("eventStartDate").value = "";
  document.getElementById("eventEndDate").value = "";
  renderBookSelectList();
  eventPopup.style.display = "flex";
});

closeEventPopupBtn.addEventListener("click", () => {
  eventPopup.style.display = "none";
});

// === Hi·ªÉn th·ªã danh s√°ch s√°ch c√≥ th·ªÉ ch·ªçn ===
function renderBookSelectList(selected = []) {
  const list = document.getElementById("bookSelectList");
  list.innerHTML = products.map(p => `
    <label>
      <input type="checkbox" value="${p.id}" ${selected.includes(p.id) ? "checked" : ""}>
      <img src="${p.image}" alt="${p.name}">
      <span>${p.name}</span>
    </label>
  `).join("");
}

// === L∆∞u ho·∫∑c c·∫≠p nh·∫≠t s·ª± ki·ªán ===
saveEventBtn.addEventListener("click", () => {
  const title = document.getElementById("eventTitle").value.trim();
  const startDate = document.getElementById("eventStartDate").value;
  const endDate = document.getElementById("eventEndDate").value;
  const selectedBooks = [...document.querySelectorAll("#bookSelectList input:checked")].map(i => i.value);

  if (!title || !startDate || !endDate) return alert("‚ö†Ô∏è Vui l√≤ng nh·∫≠p ƒë·∫ßy ƒë·ªß th√¥ng tin!");
  if (new Date(startDate) > new Date(endDate)) return alert("‚ö†Ô∏è Ng√†y b·∫Øt ƒë·∫ßu kh√¥ng th·ªÉ sau ng√†y k·∫øt th√∫c!");
  if (selectedBooks.length === 0) return alert("‚ö†Ô∏è H√£y ch·ªçn √≠t nh·∫•t 1 cu·ªën s√°ch!");

  const newEvent = {
    id: eventEditIndex !== null ? events[eventEditIndex].id : Date.now(),
    title,
    startDate,
    endDate,
    books: selectedBooks
  };

  if (eventEditIndex !== null) events[eventEditIndex] = newEvent;
  else events.push(newEvent);

  localStorage.setItem("events", JSON.stringify(events));
  renderEventList();
  eventPopup.style.display = "none";
});

// === Hi·ªÉn th·ªã danh s√°ch s·ª± ki·ªán ===
function renderEventList() {
  const container = document.getElementById("eventList");
  if (events.length === 0) {
    container.innerHTML = "<p>Ch∆∞a c√≥ s·ª± ki·ªán n√†o.</p>";
    return;
  }

  container.innerHTML = events.map((e, i) => `
    <div class="admin-product">
      <span class="product-name">${e.title}</span>
      <span>T·ª´: ${e.startDate} - ƒê·∫øn: ${e.endDate}</span>
      <div>
        <button onclick="editEvent(${i})">S·ª≠a</button>
        <button onclick="deleteEvent(${i})">X√≥a</button>
      </div>
    </div>
  `).join("");
}

// === S·ª≠a s·ª± ki·ªán ===
function editEvent(i) {
  const e = events[i];
  eventEditIndex = i;
  document.getElementById("eventPopupTitle").innerText = "S·ª≠a S·ª± Ki·ªán";
  document.getElementById("eventTitle").value = e.title;
  document.getElementById("eventStartDate").value = e.startDate;
  document.getElementById("eventEndDate").value = e.endDate;
  renderBookSelectList(e.books);
  eventPopup.style.display = "flex";
}

// === X√≥a s·ª± ki·ªán ===
function deleteEvent(i) {
  if (confirm("‚ùå B·∫°n c√≥ ch·∫Øc mu·ªën x√≥a s·ª± ki·ªán n√†y kh√¥ng?")) {
    events.splice(i, 1);
    localStorage.setItem("events", JSON.stringify(events));
    renderEventList();
  }
}

// === G·ªçi render ban ƒë·∫ßu ===
renderEventList();

// Kh·ªüi t·∫°o
renderCategoryList();
renderAdminProducts();
</script>
</body>
</html>