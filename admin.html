<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Admin - Ocean Horizon</title>
<link rel="stylesheet" href="css/index.css">
<link rel="icon" type="image/png" href="img/Ocean_Horizon_Website_Icon.png">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
<style>
 body {
  font-family: Arial, sans-serif;
  margin: 0; 
  padding: 0;
  background: #0A192F; /* deep navy */
  color: #E0F7FA;      /* light aqua text */
}

header {
  background: linear-gradient(135deg, #001F3F, #003B6F, #005B96);
  color: #E0F7FA;
  padding: 15px 30px;
  display: flex;
  justify-content: space-between;
  align-items: center;
  box-shadow: 0 2px 10px rgba(0,0,0,0.5);
}

header h1 {
  margin: 0;
  font-size: 26px;
  font-weight: bold;
  letter-spacing: 1px;
}

header a {
  color: #90E0EF;
  font-weight: bold;
  text-decoration: none;
  transition: color 0.3s;
}
header a:hover {
  color: #00B4D8;
}

.container {
  max-width: 1100px;
  margin: 30px auto;
  padding: 25px;
  background: #112D4E;
  border-radius: 12px;
  box-shadow: 0 0 20px rgba(0,0,0,0.4);
}

h2 {
  margin: 20px 0;
  text-align: center;
  font-size: 22px;
  color: #90E0EF;
}

input, select {
  padding: 10px;
  margin-right: 8px;
  margin-bottom: 12px;
  width: 220px;
  border: none;
  border-radius: 6px;
  background: #0F3460;
  color: #E0F7FA;
}
input:focus, select:focus {
  outline: 2px solid #00B4D8;
}

button {
  padding: 10px 16px;
  margin-right: 5px;
  border: none;
  border-radius: 6px;
  background: #0077B6;
  color: white;
  cursor: pointer;
  transition: all 0.3s;
  font-weight: bold;
}
button:hover {
  background: #00B4D8;
  transform: translateY(-2px);
}

ul {
  list-style: none;
  padding: 0;
}

li {
  margin-bottom: 8px;
}

.admin-product {
  display: flex;
  align-items: center;
  margin-bottom: 12px;
  background: #1B3A57;
  padding: 12px;
  border-radius: 8px;
  box-shadow: 0 2px 6px rgba(0,0,0,0.3);
}
.admin-product img {
  width: 65px;
  height: 65px;
  object-fit: cover;
  margin-right: 12px;
  border-radius: 6px;
  border: 2px solid #00B4D8;
}
.product-name {
  color: #E0F7FA !important;
  font-weight: bold;
  flex: 1;
}

.modal {
  display: none;
  position: fixed;
  top:0; left:0;
  width:100%; height:100%;
  background: rgba(0,0,0,0.7);
  justify-content: center;
  align-items: center;
}
.modal-content {
  background: #112D4E;
  padding: 25px;
  border-radius: 10px;
  width: 420px;
  position: relative;
  box-shadow: 0 0 15px rgba(0,180,216,0.6);
}
.modal-content h3 {
  margin: 0 0 15px;
  text-align: center;
  font-weight: bold;
  font-size: 20px;
  color: #00B4D8;
}
.close-btn {
  position: absolute;
  top: 10px;
  right: 15px;
  cursor: pointer;
  font-size: 22px;
  color: #90E0EF;
}

</style>
</head>
<body>
<script src="js/admin.js" defer></script>

<header>
  <h1>Quản Lý Ocean Horizon</h1>
       <a href="login.html" id="loginLink">Đăng nhập</a>
</header>

<div class="container">

  <!-- Quản lý chủ đề -->
  <section id="categoryManager">
    <h2>Quản Lý Chủ Đề</h2>
    <input type="text" id="newCategoryName" placeholder="Tên chủ đề mới">
    <button id="addCategoryBtn">Thêm Chủ Đề</button>
    <ul id="categoryList"></ul>
  </section>

  <!-- Quản lý sản phẩm -->
  <section id="productManager">
    <h2>Quản Lý Sản Phẩm</h2>
    <button id="addProductBtn">Thêm Sản Phẩm</button>
    <div id="adminProductList"></div>
  </section>

</div>

<!-- Popup Thêm/Sửa sản phẩm -->
<div id="productPopup" class="modal">
  <div class="modal-content">
    <span class="close-btn">&times;</span>
    <h3 id="popupTitle">Thêm Sản Phẩm</h3>
    <select id="productCategory"></select>
    <input type="text" id="productName" placeholder="Tên sản phẩm">
    <input type="text" id="productPrice" placeholder="Giá">
    <input type="text" id="productOldPrice" placeholder="Giá cũ (nếu có)">
    <input type="text" id="productPublisher" placeholder="Nhà xuất bản">
    <input type="text" id="productYear" placeholder="Năm xuất bản">
    <input type="file" id="productImage" accept="image/*">
    <button id="saveProductBtn">Lưu</button>
  </div>
</div>
<script>
let sections = JSON.parse(localStorage.getItem("sections")) || {};
let products = JSON.parse(localStorage.getItem("products")) || [];
let editIndex = null;

// --- Chủ đề ---
function renderCategoryList() {
  const ul = document.getElementById("categoryList");
  ul.innerHTML = '';
  Object.keys(sections).forEach(cat => {
    const li = document.createElement("li");
    li.innerHTML = `
      ${cat} 
      <button onclick="deleteCategory('${cat}')">Xóa</button>
    `;
    ul.appendChild(li);
  });
}

document.getElementById("addCategoryBtn").addEventListener("click", () => {
  const name = document.getElementById("newCategoryName").value.trim();
  if(!name) return alert("Nhập tên chủ đề!");
  if(!sections[name]) sections[name] = [];
  localStorage.setItem("sections", JSON.stringify(sections));
  document.getElementById("newCategoryName").value = '';
  renderCategoryList();
  renderCategoryOptions();
});

function deleteCategory(name) {
  if(confirm(`Xóa chủ đề "${name}" và tất cả sản phẩm trong đó?`)) {
    delete sections[name];
    localStorage.setItem("sections", JSON.stringify(sections));
    renderCategoryList();
    renderAdminProducts();
    renderCategoryOptions();
  }
}

// --- Sản phẩm ---
const popup = document.getElementById("productPopup");
const addBtn = document.getElementById("addProductBtn");
const closeBtn = popup.querySelector(".close-btn");
const saveBtn = document.getElementById("saveProductBtn");
const adminList = document.getElementById("adminProductList");

addBtn.addEventListener("click", () => {
  editIndex = null;
  popup.style.display = "flex";
  popup.querySelector("#popupTitle").innerText = "Thêm Sản Phẩm";
  popup.querySelectorAll("input").forEach(input => input.value = '');
  renderCategoryOptions();
});

closeBtn.addEventListener("click", () => popup.style.display = "none");

function renderCategoryOptions() {
  const select = document.getElementById("productCategory");
  select.innerHTML = '';
  select.innerHTML = '<option value="">Chọn chủ đề</option>';
  Object.keys(sections).forEach(cat => {
    const opt = document.createElement("option");
    opt.value = cat; opt.textContent = cat;
    select.appendChild(opt);
  });
}

saveBtn.addEventListener("click", () => {
  const category = document.getElementById("productCategory").value;
  const name = document.getElementById("productName").value.trim();
  const price = document.getElementById("productPrice").value.trim();
  const oldPrice = document.getElementById("productOldPrice").value.trim();
  const publisher = document.getElementById("productPublisher").value.trim();
  const year = document.getElementById("productYear").value.trim();
  const fileInput = document.getElementById("productImage");

  if(!category || !name || !price) return alert("Điền đầy đủ thông tin!");

  // lấy đường dẫn ảnh (nếu có upload)
  let imgPath = editIndex!==null ? products[editIndex].image : "";
  if (fileInput.files[0]) {
    imgPath = `img/${fileInput.files[0].name}`;
  }

  saveProduct(imgPath);

  function saveProduct(imgSrc) {
    const newProduct = {
      id: editIndex!==null ? products[editIndex].id : Date.now().toString(),
      name, price, oldPrice, publisher, year,
      image: imgSrc, // chỉ lưu đường dẫn
      stock: true,
      category
    };

    if(editIndex!==null) {
      const oldCat = products[editIndex].category;
      sections[oldCat] = sections[oldCat].filter(p => p.id!==newProduct.id);
      products[editIndex] = newProduct;
    } else products.push(newProduct);

    if(!sections[category]) sections[category] = [];
    const idx = sections[category].findIndex(p=>p.id===newProduct.id);
    if(idx>=0) sections[category][idx] = newProduct;
    else sections[category].push(newProduct);

    localStorage.setItem("products", JSON.stringify(products));
    localStorage.setItem("sections", JSON.stringify(sections));
    popup.style.display = "none";
    renderAdminProducts();
    renderCategoryList();
  }
});

function renderAdminProducts() {
  adminList.innerHTML = '';
  products.forEach(p => {
    const div = document.createElement("div");
    div.className = "admin-product";
   div.innerHTML = `
  <img src="${p.image}" alt="${p.name}">
  <span class="product-name">${p.name} (${p.category}) - ${p.price}đ</span>
  <button onclick="editProduct('${p.category}','${p.id}')">Sửa</button>
  <button onclick="deleteProductById('${p.id}')">Xóa</button>
`;
    adminList.appendChild(div);
  });
}

// --- Xóa sản phẩm ---
function deleteProductById(id){
  if(confirm("Bạn có chắc muốn xóa sản phẩm này?")){
    const prodIndex = products.findIndex(p => p.id===id);
    if(prodIndex >=0){
      const cat = products[prodIndex].category;
      products.splice(prodIndex,1);
      // Kiểm tra sections[cat] trước khi filter
      if(sections[cat]) {
        sections[cat] = sections[cat].filter(p=>p.id!==id);
      }
      localStorage.setItem("products", JSON.stringify(products));
      localStorage.setItem("sections", JSON.stringify(sections));
      renderAdminProducts();
      renderCategoryList();
    }
  }
}


function editProduct(cat, id) {
  const idx = products.findIndex(p => p.id === id);
  if (idx < 0) return;
  editIndex = idx;
  const p = products[idx];
  
  popup.style.display = "flex";
  popup.querySelector("#popupTitle").innerText = "Sửa Sản Phẩm";

  // 1. Render tất cả chủ đề trước
  renderCategoryOptions();

  // 2. Chọn chủ đề hiện tại
  document.getElementById("productCategory").value = cat;

  // 3. Điền thông tin sản phẩm
  document.getElementById("productName").value = p.name;
  document.getElementById("productPrice").value = p.price;
  document.getElementById("productOldPrice").value = p.oldPrice;
  document.getElementById("productPublisher").value = p.publisher;
  document.getElementById("productYear").value = p.year;
  document.getElementById("productImage").value = '';
}


function toggleStock(cat,i){
  sections[cat][i].stock = !sections[cat][i].stock;
  localStorage.setItem("sections", JSON.stringify(sections));
  renderAdminProducts();
}

// Khởi tạo
renderCategoryList();
renderAdminProducts();
</script>
</body>
</html>
